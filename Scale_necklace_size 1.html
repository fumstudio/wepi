<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="description" content="Complete your outfit and draw attention to the neckline!">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Jewelry Necklace</title>

  <!-- Favicon -->
  <link rel="shortcut icon" type="x-icon" href="https://i.postimg.cc/XqrhcVpD/20240702-095704.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AlzaSyC9FWOWTpgSGUYhnjG4maMSt7SSj09hH-8",
      authDomain: "mvimsdetce.firebaseapp.com",
      projectId: "mvimsdetce",
      storageBucket: "myimages-de8ce.appspot.com",
      messagingSenderId: "501272670548",
      appId: "your_app_id",
      measurementId: "G-D24XGXB8DK"
    };

    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);
  </script>

  <!-- Custom Styles -->
  <style>


    #loadingScreen, #secondLoadingScreen {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 24px;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #secondLoadingScreen {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 18px;
      z-index: 1001;
    }

    #imageContainer {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #ccc;
      background-color: #f0f0f0;
      position: relative;
      background-image: url('https://iconarchive.com/download/i107449/google/noto-emoji-animals-nature/horse.ico');
      background-size: 50px 50px;
      background-repeat: no-repeat;
      background-position: center;
    }

    #imageContainer img {
      max-width: 100%;
      max-height: 100%;
      transform-origin: center;
      transition: transform 0.3s ease;
    }

.slider-container {
    display: flex;
    flex-direction: column;
    padding-top: 20px;
  }

  .range-display {
    display: flex;
    align-items: center;
    margin-bottom: 10px; /* Adjust spacing as needed */
  }

  .slider-label {
    flex: 1; /* This makes the label take up available space */
    text-align: left; /* Aligns the text to the left */
    color: white ;
  }

  .slider {
    flex: 2; /* This gives the slider more space */
    margin: 0 10px; /* Space between slider and value */
  }

  .range-value {
    flex: 1; /* This makes the value take up remaining space */
    text-align: right; /* Aligns the text to the right */
    color: white ;
  }

.reset-button {
  background-color: #6DBFE5;
  color: white;
  border: 2px solid white; /* Add a border */
  border-radius: 8px; /* Rounded corners */
  padding: 10px 20px;
  cursor: pointer;
  margin-top: 10px;
  transition: background-color 0.3s, transform 0.3s; /* Smooth transitions */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Soft shadow */  
}
.delete-button {
  background-color: red;
  color: white;
  border: 2px solid white; /* Add a border */
  border-radius: 8px; /* Rounded corners */
  padding: 10px 20px;
  cursor: pointer;
  margin-top: 10px;
  transition: background-color 0.3s, transform 0.3s; /* Smooth transitions */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Soft shadow */
}
#sendToWhatsAppButton {
  background-color: #89D358;
  color: white;
  border: 2px solid white; /* Add a border */
  border-radius: 8px; /* Rounded corners */
  padding: 10px 20px;
  cursor: pointer;
  margin-top: 10px;
  transition: background-color 0.3s, transform 0.3s; /* Smooth transitions */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Soft shadow */
}

#uploadButton {
  background-color: #6DBFE5;
  color: white;
  border: 2px solid white; /* Add a border */
  border-radius: 8px; /* Rounded corners */
  padding: 10px 20px;
  cursor: pointer;
  margin-top: 10px;
  transition: background-color 0.3s, transform 0.3s; /* Smooth transitions */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Soft shadow */  
}

    .hidden {
      display: none;
    }

    #controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px;
    }

    #sendToWhatsAppButton {
      display: none;
      margin-top: 10px;
    }

    #buttonContainer {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }

    #deleteButton {
      margin-left: 10px;
    }

.range-display {
  display: flex;
  justify-content: space-between; /* Distributes items evenly */
  align-items: center; /* Centers items vertically */
  margin-bottom: 10px;
}


.custom-title {
    color: white; /* Sets the text color to white */
    background-color: #4A90E2; /* Background color for contrast */
    border: 2px solid #FFFFFF; /* White border */
    border-radius: 8px; /* Rounded corners */
    padding: 10px 15px; /* Padding around the text */
    text-align: center; /* Center the text */
    font-size: 1.5em; /* Adjust font size */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Adds shadow for depth */
}

.back {
    max-width: 400px;
    margin: 0 auto;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 5px;
    
}
  </style>
</head>
<body>
    <div id="loadingScreen">Uploading... 0%</div>
                <div id="secondLoadingScreen">Processing... Please wait</div>
    <div id="controls">
        <div class="back">
  <div class="back">
          <div id="imageContainer">

        <i class="fas fa-image"></i>
        <p>Custom jewelry</p>
    </div>
</div>
        <div class="slider-container">
            <div class="range-display">
                <label class="slider-label" for="zoomRange">Zoom</label>
                <input type="range" id="zoomRange" class="slider" min="1" max="3" step="0.1" value="1.5">
                <span id="zoomValue" class="range-value">1.5</span>
            </div>
            <div class="range-display">
                <label class="slider-label" for="moveX">Left  | right</label>
                <input type="range" id="moveX" class="slider" min="-100" max="100" step="1" value="0">
                <span id="moveXValue" class="range-value">0</span>
            </div>
            <div class="range-display">
                <label class="slider-label" for="moveY">Up | down</label>
                <input type="range" id="moveY" class="slider" min="-100" max="100" step="1" value="0">
                <span id="moveYValue" class="range-value">0</span>
            </div>
        </div>
        <button id="resetButton" class="reset-button hidden">Reset Image</button>
        <div id="buttonContainer">
            <button id="deleteButton" class="delete-button hidden">Delete Image</button>
<button id="sendToWhatsAppButton">
    <i class="fas fa-share"></i> Submit 
</button>

            <input type="file" id="fileInput" style="display: none;">
            <label for="fileInput" id="uploadButton" class="custom-file-upload">
                <i class="fas fa-camera"></i> Upload Photo
            </label>
        </div>
    </div>
</div>
    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-storage.js";

const firebaseConfig = {
    apiKey: "AlzaSyC9FWOWTpgSGUYhnjG4maMSt7SSj09hH-8",
    authDomain: "mvimsdetce.firebaseapp.com",
    projectId: "mvimsdetce",
    storageBucket: "myimages-de8ce.appspot.com",
    messagingSenderId: "501272670548",
    appId: "your_app_id",
    measurementId: "G-D24XGXB8DK"
};

const app = initializeApp(firebaseConfig);
const storage = getStorage(app);

document.addEventListener('DOMContentLoaded', () => {
    const fileInput = document.getElementById('fileInput');
    const uploadButton = document.getElementById('uploadButton');
    const imageContainer = document.getElementById('imageContainer');
    const sendToWhatsAppButton = document.getElementById('sendToWhatsAppButton');
    const deleteButton = document.getElementById('deleteButton');
    const resetButton = document.getElementById('resetButton');
    const loadingScreen = document.getElementById('loadingScreen');
    const secondLoadingScreen = document.getElementById('secondLoadingScreen');
    const zoomRange = document.getElementById('zoomRange');
    const moveX = document.getElementById('moveX');
    const moveY = document.getElementById('moveY');
    const zoomValue = document.getElementById('zoomValue');
    const moveXValue = document.getElementById('moveXValue');
    const moveYValue = document.getElementById('moveYValue');

    let uploadedImageUrl;
    let startX, startY, initialX, initialY, startDistance, initialScale, isDragging = false;

    // Load saved image and transformations
    loadSavedData();

    fileInput.addEventListener('change', handleFileSelect);
    resetButton.addEventListener('click', resetTransform);
    deleteButton.addEventListener('click', deleteImage);
    sendToWhatsAppButton.addEventListener('click', sendWhatsAppMessage);

    zoomRange.addEventListener('input', applyTransform);
    moveX.addEventListener('input', applyTransform);
    moveY.addEventListener('input', applyTransform);

    imageContainer.addEventListener('touchstart', handleTouchStart);
    imageContainer.addEventListener('touchmove', handleTouchMove);
    imageContainer.addEventListener('touchend', handleTouchEnd);

    function handleFileSelect() {
        if (uploadedImageUrl) {
            alert('Only one picture is allowed to be uploaded. Please delete the existing picture to upload a new one.');
            fileInput.value = '';
            return;
        }

        const file = fileInput.files[0];
        if (file) {
            resizeImage(file).then(resizedBlob => {
                const storageRef = ref(storage, 'images/' + file.name);
                const uploadTask = uploadBytesResumable(storageRef, resizedBlob);

                uploadTask.on('state_changed', (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    loadingScreen.textContent = `Uploading... ${Math.round(progress)}%`;
                    loadingScreen.style.display = 'flex';
                }, (error) => {
                    console.error('Upload failed:', error);
                    loadingScreen.style.display = 'none';
                }, () => {
                    getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                        uploadedImageUrl = downloadURL;
                        localStorage.setItem('imageUrl', uploadedImageUrl);
                        localStorage.setItem('zoomValue', zoomRange.value);
                        localStorage.setItem('moveXValue', moveX.value);
                        localStorage.setItem('moveYValue', moveY.value);

                        const imgElement = document.createElement('img');
                        imgElement.src = uploadedImageUrl;
                        imageContainer.innerHTML = '';
                        imageContainer.appendChild(imgElement);
                        loadingScreen.style.display = 'none';
                        
                        // Show the second loading screen
                        secondLoadingScreen.style.display = 'flex';

                        // Hide the second loading screen after 5 seconds
                        setTimeout(() => {
                            secondLoadingScreen.style.display = 'none';
                            applyTransform();
                        }, 5000);

                        uploadButton.style.display = 'none';
                        deleteButton.classList.remove('hidden');
                        sendToWhatsAppButton.style.display = 'block';
                        resetButton.classList.remove('hidden');
                    });
                });
            });
        }
    }

    function resizeImage(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    let width = img.width;
                    let height = img.height;

                    if (width > height) {
                        if (width > 1024) {
                            height *= 1024 / width;
                            width = 1024;
                        }
                    } else {
                        if (height > 1024) {
                            width *= 1024 / height;
                            height = 1024;
                        }
                    }

                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);

                    canvas.toBlob((blob) => {
                        if (blob.size > 400 * 1024) {
                            const scaleFactor = Math.sqrt(400 * 1024 / blob.size);
                            const newWidth = Math.floor(width * scaleFactor);
                            const newHeight = Math.floor(height * scaleFactor);

                            const canvasScaled = document.createElement('canvas');
                            canvasScaled.width = newWidth;
                            canvasScaled.height = newHeight;
                            const ctxScaled = canvasScaled.getContext('2d');
                            ctxScaled.drawImage(canvas, 0, 0, newWidth, newHeight);

                            canvasScaled.toBlob(resolve, file.type);
                        } else {
                            resolve(blob);
                        }
                    }, file.type);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        });
    }

    function resetTransform() {
        zoomRange.value = 1.5;
        moveX.value = 0;
        moveY.value = 0;
        applyTransform();
        localStorage.setItem('zoomValue', zoomRange.value);
        localStorage.setItem('moveXValue', moveX.value);
        localStorage.setItem('moveYValue', moveY.value);
    }

    function deleteImage() {
        imageContainer.innerHTML = '';
        uploadedImageUrl = null;
        localStorage.removeItem('imageUrl');
        localStorage.removeItem('zoomValue');
        localStorage.removeItem('moveXValue');
        localStorage.removeItem('moveYValue');
        fileInput.value = '';
        uploadButton.style.display = 'block';
        deleteButton.classList.add('hidden');
        sendToWhatsAppButton.style.display = 'none';
        resetButton.classList.add('hidden');
    }

    function sendWhatsAppMessage() {
        if (uploadedImageUrl) {
            const zoom = zoomRange.value;
            const moveXValue = moveX.value;
            const moveYValue = moveY.value;
            const catalogLink = "https://yourcataloglink.com";
            const message = `Catalog Link: ${catalogLink}\n\nImage URL: ${uploadedImageUrl}\nZoom: ${zoom}\nLeft | Right: ${moveXValue}\nUp | Down: ${moveYValue}`;
            window.open(`https://wa.me/0659860276?text=${encodeURIComponent(message)}`, '_blank');
        }
    }

    function applyTransform() {
        const imgElement = imageContainer.querySelector('img');
        if (imgElement) {
            imgElement.style.transform = `scale(${zoomRange.value}) translate(${moveX.value}px, ${moveY.value}px)`;
            zoomValue.textContent = zoomRange.value;
            moveXValue.textContent = moveX.value;
            moveYValue.textContent = moveY.value;

            // Save transformations to localStorage
            localStorage.setItem('zoomValue', zoomRange.value);
            localStorage.setItem('moveXValue', moveX.value);
            localStorage.setItem('moveYValue', moveY.value);
        }
    }

    function handleTouchStart(e) {
        if (e.touches.length === 2) {
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            startDistance = Math.sqrt(dx * dx + dy * dy);
            const imgElement = imageContainer.querySelector('img');
            initialScale = parseFloat(imgElement.style.transform.split('scale(')[1]) || 1;
        } else if (e.touches.length === 1) {
            isDragging = true;
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
            const imgElement = imageContainer.querySelector('img');
            initialX = parseFloat(imgElement.style.transform.split('translate(')[1].split(' ')[0]) || 0;
            initialY = parseFloat(imgElement.style.transform.split('translate(')[1].split(' ')[1].replace(')', '')) || 0;
        }
    }

    function handleTouchMove(e) {
        if (e.touches.length === 2) {
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            const newDistance = Math.sqrt(dx * dx + dy * dy);
            const scale = initialScale * (newDistance / startDistance);
            zoomRange.value = scale;
            applyTransform();
        } else if (e.touches.length === 1 && isDragging) {
            const deltaX = e.touches[0].clientX - startX;
            const deltaY = e.touches[0].clientY - startY;
            moveX.value = initialX + deltaX;
            moveY.value = initialY + deltaY;
            applyTransform();
        }
    }

    function handleTouchEnd() {
        isDragging = false;
    }

    function loadSavedData() {
        const savedImageUrl = localStorage.getItem('imageUrl');
        const savedZoomValue = localStorage.getItem('zoomValue');
        const savedMoveXValue = localStorage.getItem('moveXValue');
        const savedMoveYValue = localStorage.getItem('moveYValue');

        if (savedImageUrl) {
            uploadedImageUrl = savedImageUrl;
            const imgElement = document.createElement('img');
            imgElement.src = uploadedImageUrl;
            imageContainer.innerHTML = '';
            imageContainer.appendChild(imgElement);
            uploadButton.style.display = 'none';
            deleteButton.classList.remove('hidden');
            sendToWhatsAppButton.style.display = 'block';
            resetButton.classList.remove('hidden');
            zoomRange.value = savedZoomValue || 1.5;
            moveX.value = savedMoveXValue || 0;
            moveY.value = savedMoveYValue || 0;
            applyTransform();
        }
    }
});

    </script>
</body>
</html>
